<html><head>
    <style text="text/css">
    html, body {
        padding: 0; margin: 0;
    }
    #canvas {
        width: 6000px;
        height: 6000px;
        position: absolute;
        top: 0px;
        left: 0px;
    }
    #window {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    </style>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    </head>
    <body>
    <div id="window">
    <canvas id="canvas" width="6000" height="6000" style="cursor: default; top: -12px; left: 0px;"></canvas>
    </div>
	<!-- Подключаем jQuery, а также Socket.io -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    
	<script>
		window.onload = function(){
            var socket = io.connect('http://localhost:3000'); // Подключились к серверу
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            var objs = [];
            var x = -30, y = 0;
	                           canvas.addEventListener('click', function (event) {
                var x = event.clientX - cx, y = event.clientY - cy;
                var pxt = x/30;
                var pxy = y/30;
	        pxt = truncated(pxt,0);
	        pxy = truncated(pxy,0)
                pxy = (pxy * 200) + pxt + 1;
               ctx.beginPath();
                ctx.fillStyle = "rgb("+1+","+1+","+1+")";
	        
                ctx.fillRect(objs[pxy-1].x, objs[pxy-1].y, 30, 30);
                
                    socket.emit('message',{
                     id:o.id,
                     r:r,
                     g:g,
                     b:b
                    });
                
            });
            for (var i = 1; i<=39999; i++) {
                x = x + 30;
                if (i == ((y+30)/30)*200){y = y + 30; x = -30;}
                objs.push({
	            	'x': x,
	            	'y': y,	    	
                    'r': 50,
                    'g': 130,
                    'b': 184,
                    'id': i,
	            })	
		    ctx.fillStyle = "rgb("+200+","+200+","+200+")";
                ctx.fillRect(objs[i-1].x, objs[i-1].y, 30, 30);
            }
            var pixbase = [];
            socket.on('pixbase', function(messageObject){
                pixbase = messageObject;
                for (var i = 1; i<39999; i++) {
                    ctx.fillStyle = "rgb("+pixbase[i].r+","+pixbase[i].g+","+pixbase[i].b+")";
                    ctx.fillRect(objs[i].x, objs[i].y, 30, 30);
                }
            });
            var capture = false, cx = 0, cy = 0;
            x = 0; y = 0;
	//FORPHONECAMCONTROL_START
            canvas.addEventListener('touchstart', function (event) {
	            capture = true;
	            x = event.touches[0].clientX;
	            y = event.touches[0].clientY;
            }, false);
            canvas.addEventListener('touchend', function () {
	            capture = false;
	            canvas.style.cursor = 'default';
            }, false);
            canvas.addEventListener('touchmove', function (event) {
	            if (capture) {
		            cx -= x - event.touches[0].clientX, cy -= y - event.touches[0].clientY;
		            canvas.style.top  = cy + 'px';
		            canvas.style.left = cx + 'px';
		            x = event.touches[0].clientX;
		            y = event.touches[0].clientY;	
	            }
            }, false);
            //FORPHONECAMCONTROL_END
			
	     canvas.addEventListener('mousedown', function (event) {
	            capture = true;
	            x = event.clientX;
	            y = event.clientY;
            }, false);
            canvas.addEventListener('mouseup', function () {
	            capture = false;
	            canvas.style.cursor = 'default';
            }, false);
            canvas.addEventListener('mousemove', function (event) {
	            if (capture) {
		            cx -= x - event.clientX, cy -= y - event.clientY;
		            canvas.style.top  = cy + 'px';
		            canvas.style.left = cx + 'px';
		            x = event.clientX;
		            y = event.clientY;	
	            }
            }, false);
	    function truncated(num, decimalPlaces) {    
		    let numPowerConverter = Math.pow(10, decimalPlaces); 
		    return ~~(num * numPowerConverter)/numPowerConverter;
		}


            socket.on('message', function(messageObject){
                
                console.log(messageObject);
                for (var i = 1; i<39999; i++) {
                   var o = objs[i];
                   var oo = messageObject.id;
                   if (o.id == oo) {
                    ctx.fillStyle = "rgb("+oo.r+","+oo.g+","+oo.b+")";
                    ctx.fillRect(o.x , o.y , 30, 30);
                    

                   }}
                 });
        };
	</script>

</body></html>
