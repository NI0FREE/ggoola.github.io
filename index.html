<html><head>
    <style text="text/css">
    html, body {
        padding: 0; margin: 0;
    }
    #canvas {
        width: 6000px;
        height: 6000px;
        position: absolute;
        top: 0px;
        left: 0px;
    }
    #window {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    </style>
    </head>
    <body>
    <div id="window">
    <canvas id="canvas" width="6000" height="6000" style="cursor: default; top: -12px; left: 0px;"></canvas>
    </div>
	<!-- Подключаем jQuery, а также Socket.io -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    
	<script>
		window.onload = function(){
            var socket = io.connect('http://localhost:3000'); // Подключились к серверу
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            var objs = [];
            var x = -30, y = 0;
            for (var i = 1; i<=39999; i++) {
                x = x + 30;
                if (i == ((y+30)/30)*200){y = y + 30; x = 0;}
                objs.push({
	            	'x': x,
	            	'y': y,	    	
                    'r': 50,
                    'g': 130,
                    'b': 184,
                    'id': i,
	            })	
            }
            var pixbase = [];
            socket.on('pixbase', function(messageObject){
                pixbase = messageObject;
                for (var i = 1; i<39999; i++) {
                    ctx.fillStyle = "rgb("+pixbase[i].r+","+pixbase[i].g+","+pixbase[i].b+")";
                    ctx.fillRect(objs[i].x, objs[i].y, 30, 30);
                }
            });
            var capture = false, cx = 0, cy = 0;
            x = 0; y = 0;
            canvas.addEventListener('touchstart', function (event) {
	            capture = true;
	            x = event.touches[0].clientX;
	            y = event.touches[0].clientY;
            }, false);
            canvas.addEventListener('touchend', function () {
	            capture = false;
	            canvas.style.cursor = 'default';
            }, false);
            canvas.addEventListener('touchmove', function (event) {
	            if (capture) {
			    console.log(x,y,+"!!"+cx,cy);
		            cx -= x - event.touches[0].clientX, cy -= y - event.touches[0].clientY;
		            canvas.style.top  = cy + 'px';
		            canvas.style.left = cx + 'px';
		            x = event.touches[0].clientX;
		            y = event.touches[0].clientY;	
	            }
            }, false);
            
                       canvas.addEventListener('click', function (event) {
                var x = event.clientX - cx, y = event.clientY - cy;
                console.log(x,y)
                var sc;
	            for (var i = 1; i<39999; i++) {
                    
	    	       var o = objs[i-1];
		           if (o.x < x && x < o.x + 30 && o.y < y && y < 30 + o.y) {
                    console.log(true)
                    let r = 152,g= 0,b=2;
                    var cc = "rgb("+r+","+g+","+b+")";
                    ctx.fillStyle = cc;
                    ctx.fillRect(o.x , o.y, 30, 30);
                    o.r=r;
                    o.g=g;
                    o.b=b;
				   
                    socket.emit('message',{
                     id:o.id,
                     r:r,
                     g:g,
                     b:b
                    });
                    break;
                   }
                }
            });
            socket.on('message', function(messageObject){
                
                console.log(messageObject);
                for (var i = 1; i<39999; i++) {
                   var o = objs[i];
                   var oo = messageObject.id;
                   if (o.id == oo) {
                    ctx.fillStyle = "rgb("+oo.r+","+oo.g+","+oo.b+")";
                    ctx.fillRect(o.x , o.y , 30, 30);
                    

                   }}
                 });
        };
	</script>

</body></html>
